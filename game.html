<head>
  <link
    href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css"
    rel="stylesheet"
  />
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.6.1/web3.min.js"
    integrity="sha512-5erpERW8MxcHDF7Xea9eBQPiRtxbse70pFcaHJuOhdEBQeAxGQjUwgJbuBDWve+xP/u5IoJbKjyJk50qCnMD7A=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>
</head>
Hello world
<body class="h-full">
  <div
    class="
      flex
      w-full
      h-full
      justify-center
      content-center
      items-center
      space-x-4
    "
  >
    <div class="flex flex-col space-y-6">
      <h1 class="text-center">Zelant DAO Interface</h1>
      <div class="flex flex-col space-y-2">
        <button
          onclick="loginWithEth()"
          class="
            rounded
            bg-white
            border border-gray-400
            hover:bg-gray-100
            py-2
            px-4
            text-gray-600
            hover:text-gray-700
          "
        >
          Login & Save ETH Address
        </button>
        <p id="userAddress" class="text-gray-600"></p>
        <table>
          <tr>
            <td>Contract AVAX Balance:</td>
            <td id="base_balance" class="text-gray-600"></td>
          </tr>
        </table>
        <button
          id="logoutButton"
          onclick="logout()"
          class="hidden text-blue-500 underline"
        >
          Logout
        </button>
      </div>
      <h1 class="text-center">Your LEVEL Balances</h1>
      <table>
        <tr>
          <td>LEVEL 0 Balance:</td>
          <td id="LEVEL0Balance" class="text-gray-600"></td>
        </tr>
        <tr>
          <td>LEVEL 1 Balance:</td>
          <td id="LEVEL1Balance" class="text-gray-600"></td>
        </tr>
        <tr>
          <td>LEVEL 2 Balance:</td>
          <td id="LEVEL2Balance" class="text-gray-600"></td>
        </tr>
        <tr>
          <td>LEVEL 3 Balance:</td>
          <td id="LEVEL3Balance" class="text-gray-600"></td>
        </tr>
        <tr>
          <td>LEVEL 4 Balance:</td>
          <td id="LEVEL4Balance" class="text-gray-600"></td>
        </tr>
      </table>
      <button
        id="getContractInfo"
        onclick="getContractSymbol()"
        class="rounded bg-blue-500 hover:bg-blue-700 py-2 px-4 text-white"
      >
        Check Contract Status
      </button>
      <p id="123"></p>
      <button
        id="FlipTheCoin"
        onclick="flipTheCoin()"
        class="rounded bg-blue-500 hover:bg-blue-700 py-2 px-4 text-white"
      >
        FlipCoin
      </button>

      <div class="flex flex-col space-y-2"></div>
    </div>
  </div>

  <script>
    //const CONTRACT_ADDRESS = "0xc31E21f97043b0538Ffc948c27AeD80866344e9e";
    const CONTRACT_ADDRESS = "0x288852D4137a7fCa6B379cE796a46E8B26E5F2AF";

    window.userAddress = null;
    window.onload = async () => {
      // Init Web3 connected to ETH network
      if (window.ethereum) {
        window.web3 = new Web3(window.ethereum);
      } else {
        alert("No ETH brower extension detected.");
      }

      // Load in Localstore key
      window.userAddress = window.localStorage.getItem("userAddress");
      showAddress();
    };

    // Use this function to turn a 42 character ETH address
    // into an address like 0x345...12345
    function truncateAddress(address) {
      if (!address) {
        return "";
      }
      return `${address.substr(0, 5)}...${address.substr(
        address.length - 5,
        address.length
      )}`;
    }

    // Display or remove the users know address on the frontend
    async function showAddress() {
      if (!window.userAddress) {
        document.getElementById("userAddress").innerText = "";
        document.getElementById("logoutButton").classList.add("hidden");
        return false;
      }

      document.getElementById(
        "userAddress"
      ).innerText = `Your Address: ${truncateAddress(window.userAddress)}`;
      document.getElementById("logoutButton").classList.remove("hidden");

      var level0_balance = await getLevelBalance(0);
      document.getElementById("LEVEL0Balance").innerText = level0_balance;
      var base_balance = await getContractBaseBalance();
      document.getElementById("base_balance").innerText = `${base_balance / (10**18)} AVAX`;
    }

    // remove stored user address and reset frontend
    function logout() {
      window.userAddress = null;
      window.localStorage.removeItem("userAddress");
      document.getElementById("userAddress").innerText = "";
      showAddress();
    }

    // Login with Web3 via Metamasks window.ethereum library
    async function loginWithEth() {
      if (window.web3) {
        try {
          // We use this since ethereum.enable() is deprecated. This method is not
          // available in Web3JS - so we call it directly from metamasks' library
          const selectedAccount = await window.ethereum
            .request({
              method: "eth_requestAccounts",
            })
            .then((accounts) => accounts[0])
            .catch(() => {
              throw Error("No account selected!");
            });
          window.userAddress = selectedAccount;
          window.localStorage.setItem("userAddress", selectedAccount);
          showAddress();
        } catch (error) {
          console.error(error);
        }
      } else {
        alert("No ETH brower extension detected.");
      }
    }

    // Go to blockchain and get the contract symbol. Keep in mind
    // YOU MUST BE CONNECT TO RINKEBY NETWORK TO USE THIS FUNCTION
    // why -> because this specific contract address is on ethereum.
    // When you click login, just make sure your network is Rinkeby and it will all workout.
    async function getContractSymbol() {

      const contract = new window.web3.eth.Contract(
        window.ABI,
        CONTRACT_ADDRESS
      );
      const status = await contract.methods
        .testContractLoad()
        .call({ from: window.userAddress });
      alert(`Contract ${CONTRACT_ADDRESS} Status: ${status}`);
    }

    async function getLevelBalance(level_id) {
      const contract = new window.web3.eth.Contract(
        window.ABI,
        CONTRACT_ADDRESS
      );
      const level0_balance = contract.methods
        .balanceOf(window.userAddress, level_id)
        .call({ from: window.userAddress });
      return level0_balance;
    }

    async function getContractBaseBalance(level_id) {
      //step 1 find the contract
      const tavi = new window.web3.eth.Contract(
        window.ABI,
        CONTRACT_ADDRESS
      );
      //step 2 run the function on the contract
      const base_balance = tavi.methods.getAvaxBalance().call({ from: window.userAddress });
      //step 3 return result
      return base_balance;
    }







    async function flipTheCoin() {
      const tavi = new window.web3.eth.Contract(window.ABI,CONTRACT_ADDRESS);
      const results = await tavi.methods.flipCoin().call({ from: window.userAddress });
      document.getElementById("123").innerText = results;
      return results;
    }


    window.ABI = [
	{
		"inputs": [],
		"name": "flipCoin",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getAvaxBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "testContractLoad",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
  </script>
</body>
